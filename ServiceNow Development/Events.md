# Events
**Events:** are an indication in ServiceNow that something notable has occurred.  Events can be generated by server-side scripts, workflows, ServiceNow processes, or by user actions such as:
- Impersonating a user
- Logging in
- Viewing a record
- Modifying a record

Each **Event** is an entry in an event queue and not an action.  Unless logic is created to repond to events, nothing happens with an event after it is generated.  Responses can be:
- Email notification
- Script Action (server-side script)

The generalized process to work with events is:
1. Add event to the **Event Registry** (Not needed if you generate an already registered event).
2. Generate the event
3. respond to the event

![[EventWorkflow.png]]

## Event Registry
ServiceNow can only respond to events that are registered with the **Event Registry**.  Registering an event lets the ServiceNow processes recognize and respond to the event.

### Registering an Event
1. Click the *Create Application File* link
2. Choose the **Event Registration** file type
3. Configure the new file


## Generating Events
There are two ways to generate events: 
- Server-side script
- Workflow *Create Event* activity

### Server-side Script
The `eventQueue()` and `eventQueueScheduled()` methods are part of the GlideSystem server-side API.  Use the `eventQueue()` and `eventQueueScheduled()` methods to generate events in the server-side scripts.

The `eventQueue()` method inserts an event in an eventQueue.  It takes four parameters with a 5th optional parameter:
1. `String` Event name
2. `GlideRecord` current
3. `String` parm1
4. `String` parm2
5. (Optional) `String` queueName

Example: 
```js
// Set Variables
var eventName = 'x_60157_employee_spe.employeeOccasion';
var parm1 = "hello";
var parm2 = gs.getUserName();

// Call eventQueue()
gs.eventQueue(eventName, current, parm1, parm2);
```

### Create Event Workflow Activity
`* Note that workflow is outdated and one should use flow`

The **Create Event** workflow activity is part of the *Notifications* category.

![[CreateEventLocation.png]]

to configure the *Create Event* workflow activity, select an *Event* name from the reference list.  Use the *Parameter 1* and *Parameter 2* script fields to return *String* values for *parm1* and *parm2*.  The activity automatically passes current as the event's *GlideRecord* object.  There is no field to specify the event queue.

## Checking for Events
Use the **Event Log** to see which events have been generated.  Located at **System Policy > Events > Event Log**.

If there is no value in the *Queue* column, the event was processed by the default queue.

## Responding to Events
There are two possible ways to respond to events:
- Email Notification
- Script Action

### Script Actions
**Script Actions:** are event handlers; server-side script logic that executes in response to events.

#### Creating Script Actions
1. Click the **Create Application File** link
2. Choose the **Script Action** file type
3. Configure the new file

#### Script Action Scripts
**Script Actions** have two scripting fields:
- Condition Script
- Script

They can also access two useful objects:
- event
- current

The *Script* field, but not the *Condition* field, has access to the *event* object.  To use *parm1* and *parm2*, reference them as properties on the *event* object:

```js
if(event.parm2 != 'admin'){...}
```

Both scripting fields have access to the *current* object.  For Script Actions, *current* is the object that was passed in by the `gs.eventQueue()` method.

## Custom Queues
Applications that create a large volume of events and/or events that take a long time to process should use a custom queue.

Populate the *Queue* field for the event in the **Event Registry** to define a custom queue.  Use only lowercase letters, no spaces, and no special characters except underscore(\_).

Adding a value to the *Queue* field creates the custom queue.  When an event is generated for a custom queue, they will be stuck in the queue, because there is no process watching the queue for events.

### Createing a Custom Queue Process
>**IMPORTANT:** USE CAUTION WHEN FOLLOWING THESE STEPS.  DO **NOT** OVERWRITE THE **_text index events process_** SCHEDULED JOB.

To create a process to watch a custom queue, **COPY** the **text index events process** Scheduled Job.

1. Goto **System Scheduler > Scheduled Jobs > Scheduled Jobs
2. Locate the **text index process** Scheduled Job and open the record for editing.
3. Change the Schedule Item **Name** and the queue name in the **Job context**.  The queue name passed to the `GlideEventManager()` must be an exact match to the queue name in the Event Registry. ![[updateCustomQueueProcess.png]]
4. **DO NOT CLICK THE UPDATE BUTTON** because that will overwrite the *text index process* Schedule itme.  Instead use **Insert and Stay** to create a new record.

### Using Custom Queues
After cusom quwuws and a queue process are created, use the `gs.eventQueue()` method's optional 5th parameter to send events to the custom queue.

Example:
```js
// Set Event Name
var eventName = 'x_60157_employee_spe.employeeOccasion';

// Generate Queue
gs.eventQueue(eventName, todaysOccasions, todaysOccasions.number, gs.getUserName,'my_queue');
```



